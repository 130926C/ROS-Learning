## demo32

欧拉角、四元数、旋转矩阵相互转化。



上面三个数学概念都可以用来表示一个物体在空间上的旋转，但四元数和旋转矩阵的概念比较晦涩难懂，我在此处进行解释可能会存在误导，所以读者应该自己去寻找材料。这三个变量主要被用来计算空间向量的旋转、坐标系转化、角位移、方位角平滑插值，有了这些值就可以定义物体在空间中的旋转行为。



在ROS中最常用的是**欧拉角**和**四元数**之间的相互转化，因为欧拉角是由三个数表示的一个向量，在实际空间中能够很容易被理解，以飞机翻滚、俯仰、偏航作为对比就很轻松了。然而，在使用过程中会出现万向节死锁（Gimbal Lock）问题，这里推荐了几个比较简单的学习连接：

* B站up主**白玉无冰**的视频[3d旋转欧拉角与万向锁！Cocos Creator 3D!](https://www.bilibili.com/video/BV1Bt4y1v7R1/?spm_id_from=333.788.recommend_more_video.3&vd_source=c8dbe5ab3b4bf743fae13d455b4aa039)；
* 知乎博主**大脸怪**的回答[如何通俗地解释欧拉角？之后为何要引入四元数？](https://www.zhihu.com/question/47736315/answer/236808639)；



简而言之，如果使用欧拉角来对物体的旋转进行描述，是当某个方向旋转了90度后存在丢失一个方向的旋转能力的风险，这被称为万向死锁。造成这个现象的根本原因是：**空间中任意角度的转向都可以用至少两种旋转方式获得**（如固定两个轴后的旋转可以从正向开始，也可以从负向开始），这样会导致一个情况，我们无法确定当前朝向是怎么旋转过来的，如果期望它是通过正向旋转走的路径是圆弧，那么负向旋转走的路径可能是不规则曲线。这是由于计算机导致的，在计算机中存在一个转向顺序（如先x后y再z），而真实世界中三个坐标轴是可以同时转动的。假如当前朝向是 （10，50，30）要求朝向到（20，80，0），那么旋转有下面两种可选方案：

* 按照xyz旋转则是（10+10，50，30）-> （20，50+30，30）-> （20，80，30-30）

* 按照yzx旋转则是（10，50+30，10）-> （10，80，30-30）-> （10+10，80，0）



显然上面两种旋转方式走过的路径完全不同，在工业设计中机械臂的运动轨迹是不能随意规划的，所以用欧拉角来描述物体旋转不合适。如果现在有一个假象轴可以将旋转轴固定住，那么就能解决上面的问题，这就是四元数。



这里列出一个基本框架来对比上述三个变量之间的关系。

| 任务/性质            | 旋转矩阵 | 欧拉角                         | 四元数                             |
| -------------------- | -------- | ------------------------------ | ---------------------------------- |
| 计算坐标系之间的旋转 | 能       | 不能                           | 不能                               |
| 参数两               | 9        | 3                              | 4                                  |
| 对旋转方向唯一表示   | 能       | 不能（有无数种）               | 不能（至多2种）                    |
| 数据合理性           | 矩阵蠕变 | 任意三个数都可以构成合法欧拉角 | 可能存在累计误差导致产生非法四元数 |



如果对上面的概念还不理解的话也没关系，在后面的使用过程中多留意下，当下只需要记住尽可能用四元数来描述物体的旋转行为。在ROS中提供了从欧拉角转化到四元数的类和函数。









